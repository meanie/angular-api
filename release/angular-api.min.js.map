{"version":3,"sources":["angular-api.min.js","action.service.js","api.service.js","baseModel.service.js","endpoint.service.js","request.service.js"],"names":["_typeof","Symbol","iterator","obj","constructor","window","angular","undefined","module","factory","$q","$injector","$log","$url","validatedModel","model","has","warn","ApiAction","action","endpoint","extend","this","url","concat","method","enforceDataFormat","config","key","hasOwnProperty","params","prototype","hasBody","test","expectsArray","Boolean","isArray","expectsModel","isModel","convertToModel","data","_this","map","Model","get","parseData","successInterceptor","response","raw","dataKey","Error","errorInterceptor","reject","provider","defaults","verbose","baseUrl","actions","query","create","update","delete","id","stripTrailingSlashes","endpoints","setVerbose","setBaseUrl","replace","setEnforceDataFormat","enforce","setDefaultActions","setDefaultParams","setDefaultModel","setConfig","param","value","strip","registerEndpoint","name","$get","$apiEndpoint","Api","forEach","info","$window","dateStringToMoment","regex","match","date","moment","ISO_8601","isValid","copyProperty","_ret","arr","v","isFunction","clone","copy","$baseModel","parent","_parent","Object","defineProperty","enumerable","set","fromJSON","isString","isId","json","_this2","isObject","valueFromJSON","toJSON","valueToJSON","extract","properties","_this3","length","substr","merge","_this4","clear","stripId","ModelClass","$parent","isSame","setParent","_isAMomentObject","prop","onlyId","_len","arguments","keys","Array","_key","apply","includes","stripIds","str","$apiAction","$apiRequest","ApiEndpoint","$config","$actions","bind","$http","isValidDottedPath","path","lookupDottedPath","split","i","combineParams","actionParams","givenParams","extractedParams","charAt","findUrlParams","urlParams","RegExp","cleanUpUrl","parseUrl","t","urlParam","val","isDefined","encodedVal","encodeUriSegment","tail","leadingSlashes","createRequestConfig","request","stripConfigKeys","indexOf","then","error"],"mappings":"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","file":"angular-api.min.js","sourcesContent":["/**\n * @meanie/angular-api * https://github.com/meanie/angular-api\n *\n * Copyright (c) 2019 Adam Reis <adam@reis.nz>\n * License: MIT\n */\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n(function (window, angular, undefined) {\n  'use strict';\n\n  /**\n   * Module definition and dependencies\n   */\n\n  angular.module('Api.Action.Service', ['Url.Service'])\n\n  /**\n   * Factory definition\n   */\n  .factory('$apiAction', ['$q', '$injector', '$log', '$url', function $apiAction($q, $injector, $log, $url) {\n\n    /**\n     * Return validated model class\n     */\n    function validatedModel(model) {\n\n      //No model?\n      if (!model) {\n        return null;\n      }\n\n      //Validate\n      if (!$injector.has(model)) {\n        if (model !== '$baseModel') {\n          $log.warn('Unknown model class/service:', model);\n        }\n        return null;\n      }\n\n      //Return model\n      return model;\n    }\n\n    /**\n     * Constructor\n     */\n    function ApiAction(action, endpoint) {\n\n      //Set vars\n      angular.extend(this, action);\n\n      //Set full action url, model and method\n      this.url = $url.concat(endpoint.url, this.url || '');\n      this.model = this.model || endpoint.model || false;\n      this.method = this.method || 'GET';\n      this.enforceDataFormat = endpoint.enforceDataFormat || false;\n\n      //Append config\n      if (endpoint.config) {\n        for (var key in endpoint.config) {\n          if (endpoint.config.hasOwnProperty(key)) {\n            this[key] = endpoint.config[key];\n          }\n        }\n      }\n\n      //Determine params\n      if (typeof this.params === 'undefined') {\n        this.params = endpoint.params;\n      }\n\n      //Normalize\n      this.params = this.params || {};\n\n      //Validate model\n      this.model = validatedModel(this.model);\n    }\n\n    /**\n     * Has body check\n     */\n    ApiAction.prototype.hasBody = function () {\n      return (/^(POST|PUT|PATCH)$/i.test(this.method)\n      );\n    };\n\n    /**\n     * Expects array check\n     */\n    ApiAction.prototype.expectsArray = function () {\n      return Boolean(this.isArray);\n    };\n\n    /**\n     * Expects model check\n     */\n    ApiAction.prototype.expectsModel = function () {\n      return this.model && Boolean(this.isModel);\n    };\n\n    /**\n     * Convert raw response data to a model\n     */\n    ApiAction.prototype.convertToModel = function (data) {\n      var _this = this;\n\n      //Array given?\n      if (angular.isArray(data)) {\n        return data.map(function (data) {\n          return _this.convertToModel(data);\n        });\n      }\n\n      //No data?\n      if (!data || data === null) {\n        return null;\n      }\n\n      //Get model class and return model instance\n      var Model = $injector.get(this.model);\n      return new Model(data);\n    };\n\n    /**\n     * Default error response interceptor\n     */\n    ApiAction.prototype.parseData = function (data) {\n\n      //Get flags\n      var expectsArray = this.expectsArray();\n      var expectsModel = this.expectsModel();\n\n      //Validate data type\n      var isArray = angular.isArray(data);\n      if (isArray !== expectsArray) {\n\n        //Issue warning\n        $log.warn('Expected', expectsArray ? 'array' : 'object', 'as response, got', isArray ? 'array' : typeof data === 'undefined' ? 'undefined' : _typeof(data), 'for', this.method, this.url);\n\n        //Enforce data format?\n        if (this.enforceDataFormat) {\n          data = expectsArray ? [] : {};\n        }\n      }\n\n      //Empty array if no data sent\n      if (expectsArray && !data) {\n        return [];\n      }\n\n      //Expecting model?\n      if (expectsModel) {\n        return this.convertToModel(data);\n      }\n\n      //Return as is\n      return data;\n    };\n\n    /**\n     * Default success response interceptor\n     */\n    ApiAction.prototype.successInterceptor = function (response) {\n\n      //Get raw response data\n      var raw = response.data;\n      var dataKey = this.dataKey;\n\n      //Using data key?\n\n      if (dataKey) {\n\n        //Ensure present\n        if (typeof raw[dataKey] === 'undefined') {\n          throw new Error('Unknown data key: ' + dataKey);\n        }\n\n        //Parse data and set in raw response\n        raw[dataKey] = this.parseData(raw[dataKey]);\n        return raw;\n      }\n\n      //Simple data, parse and return\n      return this.parseData(raw);\n    };\n\n    /**\n     * Default error response interceptor\n     */\n    ApiAction.prototype.errorInterceptor = function (response) {\n      return $q.reject(response);\n    };\n\n    //Return factory function\n    return function (action, endpoint) {\n      return new ApiAction(action, endpoint);\n    };\n  }]);\n})(window, window.angular);\n(function (window, angular, undefined) {\n  'use strict';\n\n  /**\n   * Module definition and dependencies\n   */\n\n  angular.module('Api.Service', ['Api.Endpoint.Service'])\n\n  /**\n   * Provider definition\n   */\n  .provider('$api', function $apiProvider() {\n\n    //Defaults\n    this.defaults = {\n      verbose: false,\n      enforceDataFormat: false,\n      baseUrl: '/',\n      actions: {\n        query: {\n          method: 'GET',\n          isArray: true,\n          isModel: true\n        },\n        get: {\n          method: 'GET',\n          isModel: true\n        },\n        create: {\n          method: 'POST'\n        },\n        update: {\n          method: 'PUT'\n        },\n        delete: {\n          method: 'DELETE'\n        }\n      },\n      params: {\n        id: '@id'\n      },\n      model: '',\n      config: {},\n      stripTrailingSlashes: true\n    };\n\n    //Registered endpoints\n    this.endpoints = {};\n\n    /**\n     * Set verbose\n     */\n    this.setVerbose = function (verbose) {\n      this.defaults.verbose = !!verbose;\n      return this;\n    };\n\n    /**\n     * Set base URL\n     */\n    this.setBaseUrl = function (url) {\n      //TODO: the replacement is protecting port numbers from later becoming\n      //removed on account of the request service url parsing thinking it's a\n      //parameter. The code there should be updated to prevent port replacement,\n      //rather than \"protecting\" it in this manner here.\n      this.defaults.baseUrl = url.replace(/:([0-9]+)/, '\\\\:$1');\n      return this;\n    };\n\n    /**\n     * Set data format enforcing\n     */\n    this.setEnforceDataFormat = function (enforce) {\n      this.defaults.enforceDataFormat = !!enforce;\n      return this;\n    };\n\n    /**\n     * Set default actions\n     */\n    this.setDefaultActions = function (actions) {\n      this.defaults.actions = actions || {};\n      return this;\n    };\n\n    /**\n     * Set default params\n     */\n    this.setDefaultParams = function (params) {\n      this.defaults.params = params || {};\n      return this;\n    };\n\n    /**\n     * Set default model\n     */\n    this.setDefaultModel = function (model) {\n      this.defaults.model = model || false;\n      return this;\n    };\n\n    /**\n     * Set a generic config parameter (use only for config params that you\n     * want to pass on to the $http service)\n     */\n    this.setConfig = function (param, value) {\n      this.defaults.config[param] = value;\n      return this;\n    };\n\n    /**\n     * Strip trailing slashes behaviour\n     */\n    this.stripTrailingSlashes = function (strip) {\n      this.defaults.stripTrailingSlashes = !!strip;\n      return this;\n    };\n\n    /**\n     * Register endpoint\n     */\n    this.registerEndpoint = function (name, config) {\n      if (name) {\n        this.endpoints[name] = config || {};\n      }\n      return this;\n    };\n\n    /**\n     * Service getter\n     */\n    this.$get = ['$log', '$apiEndpoint', function ($log, $apiEndpoint) {\n      var _this = this;\n\n      //Initialize API interface\n      var Api = function Api(endpoint) {\n        return this[endpoint];\n      };\n\n      //Append all endpoints\n      angular.forEach(this.endpoints, function (config, name) {\n\n        //Warn if overwriting\n        if (Api[name]) {\n          $log.warn('API endpoint', name, 'is being overwritten.');\n        }\n\n        //Extend endpoint config with defaults\n        config = angular.extend({}, _this.defaults, config);\n        if (config.verbose) {\n          $log.info('API endpoint', name + ':', config);\n        }\n\n        //Initialize endpoint\n        Api[name] = $apiEndpoint(name, config);\n      });\n\n      //Return\n      return Api;\n    }];\n  });\n})(window, window.angular);\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n(function (window, angular, undefined) {\n  'use strict';\n\n  /**\n   * Module definition and dependencies\n   */\n\n  angular.module('BaseModel.Service', [])\n\n  /**\n   * Model definition\n   */\n  .factory('$baseModel', ['$window', '$log', '$injector', function ($window, $log, $injector) {\n\n    //See if we have the moment service available to us\n    var moment = void 0;\n    if ($injector.has('moment')) {\n      moment = $injector.get('moment');\n    } else if (typeof $window.moment !== 'undefined') {\n      moment = $window.moment;\n    }\n\n    /**\n     * Check if given string is a ISO 8601 date string,\n     * Returns a moment if it is and null if it's not\n     */\n    function dateStringToMoment(value) {\n      var regex = /(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}).*/;\n      if (value.match(regex)) {\n        var date = moment(value, moment.ISO_8601, true);\n        if (date.isValid()) {\n          return date;\n        }\n      }\n      return null;\n    }\n\n    /**\n     * Copy a property\n     */\n    function copyProperty(obj, key) {\n      if (angular.isArray(obj[key])) {\n        var _ret = function () {\n          var arr = obj[key];\n          //eslint-disable-next-line no-unused-vars\n          return {\n            v: arr.map(function (value, key) {\n              return copyProperty(arr, key);\n            })\n          };\n        }();\n\n        if ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === \"object\") return _ret.v;\n      }\n      if (obj[key] && angular.isFunction(obj[key].clone)) {\n        return obj[key].clone();\n      }\n      return angular.copy(obj[key]);\n    }\n\n    /**\n     * Constructor\n     */\n    function $baseModel(data, parent) {\n\n      //Define parent property\n      var _parent = parent;\n      Object.defineProperty(this, '$parent', {\n        enumerable: false,\n        get: function get() {\n          return _parent;\n        },\n        set: function set(parent) {\n          _parent = parent;\n        }\n      });\n\n      //Load data\n      this.fromJSON(data);\n    }\n\n    /**************************************************************************\n     * Helper methods\n     ***/\n\n    /**\n     * Convert a property to a model\n     */\n    $baseModel.prototype.convertToModel = function (key, Model, isArray) {\n      var _this = this;\n\n      //Paremeter shuffling\n      if (typeof Model === 'boolean') {\n        isArray = Model;\n        Model = null;\n      }\n\n      //If undefined, check what we were expecting\n      if (typeof this[key] === 'undefined') {\n        if (isArray) {\n          this[key] = [];\n        } else {\n          this[key] = null;\n        }\n      }\n\n      //If no model specified or if empty, we're done\n      if (!Model || !this[key]) {\n        return;\n      }\n\n      //String specified, use injector\n      if (typeof Model === 'string') {\n        if (!$injector.has(Model)) {\n          return $log.warn('Unknown model', Model, 'specified for sub model conversion');\n        }\n        Model = $injector.get(Model);\n      }\n\n      //Already a model?\n      if (this[key] instanceof Model) {\n        return;\n      }\n\n      //Get model class and initiate\n      if (angular.isArray(this[key])) {\n        this[key] = this[key].map(function (data) {\n          return new Model(data, _this);\n        });\n      } else if (angular.isString(this[key]) && $baseModel.isId(this[key])) {\n        this[key] = new Model({ id: this[key] }, this);\n      } else {\n        this[key] = new Model(this[key], this);\n      }\n    };\n\n    /**\n     * From JSON converter\n     */\n    $baseModel.prototype.fromJSON = function (json) {\n      var _this2 = this;\n\n      if (angular.isObject(json)) {\n        angular.forEach(json, function (value, key) {\n          _this2[key] = $baseModel.valueFromJSON(value);\n        }, this);\n      }\n      return this;\n    };\n\n    /**\n     * To JSON converter\n     */\n    $baseModel.prototype.toJSON = function (data) {\n      var json = {};\n      if (data && angular.isObject(data)) {\n        angular.forEach(data, function (value, key) {\n          json[key] = $baseModel.valueToJSON(value);\n        });\n      }\n      angular.forEach(this, function (value, key) {\n        if (!json.hasOwnProperty(key)) {\n          json[key] = $baseModel.valueToJSON(value);\n        }\n      });\n      return json;\n    };\n\n    /**\n     * Extract a subset of data from the model\n     */\n    $baseModel.prototype.extract = function (properties) {\n      var _this3 = this;\n\n      //If string given, just return copy of one property\n      if (typeof properties === 'string') {\n        return copyProperty(this, properties);\n      }\n\n      //Initialize object\n      var obj = {};\n\n      //No properties given? Iterate all object properties\n      if (!angular.isArray(properties) || !properties.length) {\n        //eslint-disable-next-line no-unused-vars\n        angular.forEach(this, function (value, key) {\n          if (key.substr(0, 2) !== '$$') {\n            obj[key] = copyProperty(_this3, key);\n          }\n        });\n      } else {\n        angular.forEach(properties, function (key) {\n          obj[key] = copyProperty(_this3, key);\n        });\n      }\n\n      //Return resulting object\n      return obj;\n    };\n\n    /**\n     * Merge a set of data into the model\n     */\n    $baseModel.prototype.merge = function (data) {\n      var _this4 = this;\n\n      if (data && angular.isObject(data)) {\n        //eslint-disable-next-line no-unused-vars\n        angular.forEach(data, function (value, key) {\n          _this4[key] = copyProperty(data, key);\n        });\n      }\n      return this;\n    };\n\n    /**\n     * Clear own properties\n     */\n    $baseModel.prototype.clear = function () {\n      for (var key in this) {\n        if (this.hasOwnProperty(key)) {\n          delete this[key];\n        }\n      }\n      return this;\n    };\n\n    /**\n     * Clone\n     */\n    $baseModel.prototype.clone = function (stripId) {\n      var ModelClass = this.constructor;\n      //TODO: Should this be toJSON() ??\n      var clone = new ModelClass(this.extract(), this.$parent);\n      if (stripId) {\n        delete clone.id;\n      }\n      return clone;\n    };\n\n    /**\n     * Check if two models are the same (based on ID)\n     */\n    $baseModel.prototype.isSame = function (model) {\n      if (!model) {\n        return false;\n      }\n      if (!angular.isObject(model)) {\n        return this.id === model;\n      }\n      if (!model.id) {\n        return false;\n      }\n      return this.id && model.id && this.id === model.id;\n    };\n\n    /**\n     * Copy a property\n     */\n    $baseModel.prototype.copyProperty = function (obj, key) {\n      if (this[key] && angular.isFunction(this[key].clone)) {\n        obj[key] = this[key].clone();\n      } else {\n        obj[key] = angular.copy(this[key]);\n      }\n    };\n\n    /**\n     * Set parent\n     */\n    $baseModel.prototype.setParent = function (parent) {\n      this.$parent = parent;\n    };\n\n    /**************************************************************************\n     * Static methods\n     ***/\n\n    /**\n     * Helper to convert a value from JSON\n     */\n    $baseModel.valueFromJSON = function (value) {\n      if (angular.isArray(value)) {\n        return value.map($baseModel.valueFromJSON);\n      } else if (moment && angular.isString(value)) {\n        var date = dateStringToMoment(value);\n        return date || value;\n      } else if (value && angular.isObject(value)) {\n        if (value._isAMomentObject) {\n          return value.clone();\n        }\n        var copy = {};\n        for (var prop in value) {\n          if (value.hasOwnProperty(prop)) {\n            copy[prop] = $baseModel.valueFromJSON(value[prop]);\n          }\n        }\n        return copy;\n      }\n      return value;\n    };\n\n    /**\n    * Helper to convert a value to JSON\n    */\n    $baseModel.valueToJSON = function (value) {\n      if (angular.isArray(value)) {\n        return value.map($baseModel.valueToJSON);\n      } else if (value && angular.isObject(value)) {\n        if (angular.isFunction(value.toJSON)) {\n          return value.toJSON();\n        }\n        var copy = {};\n        for (var prop in value) {\n          if (value.hasOwnProperty(prop) && prop.substr(0, 2) !== '$$') {\n            copy[prop] = $baseModel.valueToJSON(value[prop]);\n          }\n        }\n        return copy;\n      }\n      return value;\n    };\n\n    /**\n     * Strip object to only ID\n     */\n    $baseModel.onlyId = function (obj) {\n      if (angular.isArray(obj)) {\n        return obj.map($baseModel.onlyId);\n      }\n      if (!obj || (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object' || !obj.id) {\n        return obj;\n      }\n      return obj.id;\n    };\n\n    /**\n     * Strip a given object to specific keys\n     */\n    $baseModel.strip = function (obj) {\n      for (var _len = arguments.length, keys = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        keys[_key - 1] = arguments[_key];\n      }\n\n      if (angular.isArray(obj)) {\n        return obj.map(function (obj) {\n          return $baseModel.strip.apply($baseModel, [obj].concat(keys));\n        });\n      }\n      if (!obj || (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object') {\n        return obj;\n      }\n      //eslint-disable-next-line no-unused-vars\n      angular.forEach(obj, function (value, key) {\n        if (!keys.includes(key)) {\n          delete obj[key];\n        }\n      });\n      return obj;\n    };\n\n    /**\n     * Strip ID's recursively from a given object\n     */\n    $baseModel.stripIds = function (obj) {\n      if (angular.isArray(obj)) {\n        return obj.map(function (obj) {\n          return $baseModel.stripIds(obj);\n        });\n      }\n      if (!obj || (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object') {\n        return obj;\n      }\n      if (typeof obj.id !== 'undefined') {\n        delete obj.id;\n      }\n      angular.forEach(obj, function (value) {\n        if (value && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object') {\n          $baseModel.stripIds(value);\n        }\n      });\n      return obj;\n    };\n\n    /**\n     * Test for MongoDB object ID\n     */\n    $baseModel.isId = function (str) {\n      return str.match(/^[a-f\\d]{24}$/i);\n    };\n\n    //Return\n    return $baseModel;\n  }]);\n})(window, window.angular);\n(function (window, angular, undefined) {\n  'use strict';\n\n  /**\n   * Module definition and dependencies\n   */\n\n  angular.module('Api.Endpoint.Service', ['Api.Action.Service', 'Api.Request.Service', 'Url.Service'])\n\n  /**\n   * Factory definition\n   */\n  .factory('$apiEndpoint', ['$url', '$apiAction', '$apiRequest', function $apiEndpoint($url, $apiAction, $apiRequest) {\n\n    /**\n     * Constructor\n     */\n    function ApiEndpoint(name, config) {\n      var _this = this;\n\n      //Determine full URL of endpoint\n      config.actions = config.actions || {};\n      config.url = $url.concat(config.baseUrl, config.url || $url.concat(name, ':id'));\n\n      //Expose config and actions container\n      this.$config = config;\n      this.$actions = {};\n\n      //Create action instances and bind request method to action key on endpoint\n      angular.forEach(config.actions, function (action, key) {\n        _this.$actions[key] = $apiAction(action || {}, config);\n        _this[key] = angular.bind(_this, $apiRequest, _this.$actions[key]);\n      });\n    }\n\n    //Return factory function\n    return function (name, config) {\n      return new ApiEndpoint(name, config);\n    };\n  }]);\n})(window, window.angular);\n(function (window, angular, undefined) {\n  'use strict';\n\n  /**\n   * Module definition and dependencies\n   */\n\n  angular.module('Api.Request.Service', ['Url.Service'])\n\n  /**\n   * Factory definition\n   */\n  .factory('$apiRequest', ['$http', '$url', function $apiRequest($http, $url) {\n\n    /**\n     * Check if dotted path is valid\n     */\n    function isValidDottedPath(path) {\n      return path && path !== 'hasOwnProperty' && /^(\\.[a-zA-Z_$@][0-9a-zA-Z_$@]*)+$/.test('.' + path);\n    }\n\n    /**\n     * Lookup dotted path in an object\n     */\n    function lookupDottedPath(obj, path) {\n\n      //Check if valid\n      if (!isValidDottedPath(path)) {\n        throw new Error('Invalid dotted path:' + path);\n      }\n\n      //Split path in object keys to traverse\n      var keys = path.split('.');\n      for (var i = 0; i < keys.length && obj !== undefined; i++) {\n        var key = keys[i];\n        obj = obj !== null ? obj[key] : undefined;\n      }\n\n      //Return reference\n      return obj;\n    }\n\n    /**\n     * Combine given params with extracted params from data\n     */\n    function combineParams(actionParams, givenParams, data) {\n\n      //Extract data params from action params\n      var extractedParams = {};\n      angular.forEach(actionParams || {}, function (value, key) {\n\n        //Function? Call now\n        if (angular.isFunction(value)) {\n          value = value();\n        }\n\n        //String value with @ identifier? Look up in data\n        if (angular.isString(value) && value.charAt(0) === '@') {\n          value = lookupDottedPath(data, value.substr(1));\n        }\n\n        //Set value\n        extractedParams[key] = value;\n      });\n\n      //Extend with given params\n      return angular.extend(extractedParams, givenParams || {});\n    }\n\n    /**\n     * Find URL params\n     */\n    function findUrlParams(url) {\n      var urlParams = {};\n      angular.forEach(url.split(/\\W/), function (param) {\n\n        //Filter hasOwnProperty\n        if (param === 'hasOwnProperty') {\n          throw new Error('Invalid parameter name: hasOwnProperty');\n        }\n\n        //Find all valid url params (have value, non digit)\n        if (param && !/^\\\\d+$/.test(param)) {\n          if (new RegExp('(^|[^\\\\\\\\]):' + param + '(\\\\W|$)').test(url)) {\n            urlParams[param] = true;\n          }\n        }\n      });\n      return urlParams;\n    }\n\n    /**\n     * Clean up URL\n     */\n    function cleanUpUrl(url, stripTrailingSlashes) {\n\n      //Strip trailing slashes if needed\n      if (stripTrailingSlashes) {\n        url = url.replace(/\\/+$/, '') || '/';\n      }\n\n      //Replace collapsed `/.` if found in the last URL path segment before\n      //the query, e.g. `http://url.com/id./format?q=x` becomes\n      //`http://url.com/id.format?q=x`\n      return url.replace(/\\/\\.(?=\\w+($|\\?))/, '.').replace(/\\/\\\\\\./, '/.');\n    }\n\n    /**\n     * Parse URL\n     */\n    function parseUrl(url, params, urlParams, stripTrailingSlashes) {\n\n      //Replace escaped \\:\n      url = url.replace(/\\\\:/g, ':');\n\n      //Loop the valid URL params now\n      //eslint-disable-next-line no-unused-vars\n      angular.forEach(urlParams, function (t, urlParam) {\n\n        //Extract value for this url param from given params\n        var val = params.hasOwnProperty(urlParam) ? params[urlParam] : null;\n        var regex = void 0;\n\n        //If defined and not null, encode it and replace in URL\n        if (angular.isDefined(val) && val !== null) {\n          (function () {\n            var encodedVal = $url.encodeUriSegment(val);\n            regex = new RegExp(':' + urlParam + '(\\\\W|$)', 'g');\n            //eslint-disable-next-line no-unused-vars\n            url = url.replace(regex, function (match, tail) {\n              return encodedVal + tail;\n            });\n          })();\n        }\n\n        //Otherwise, remove from URL\n        else {\n            regex = new RegExp('(/?):' + urlParam + '(\\\\W|$)', 'g');\n            //eslint-disable-next-line no-unused-vars\n            url = url.replace(regex, function (match, leadingSlashes, tail) {\n              if (tail.charAt(0) === '/') {\n                return tail;\n              } else {\n                return leadingSlashes + tail;\n              }\n            });\n          }\n      });\n\n      //Return cleaned up URL\n      return cleanUpUrl(url, stripTrailingSlashes);\n    }\n\n    /**\n     * Create request config\n     */\n    function createRequestConfig(action, params, data, config) {\n\n      //Initialize\n      var request = {};\n      var stripConfigKeys = ['params', 'model', 'isArray', 'isModel', 'successInterceptor', 'errorInterceptor', 'stripTrailingSlashes'];\n\n      //Map action config to http request config\n      angular.forEach(action, function (value, key) {\n        if (stripConfigKeys.indexOf(key) === -1) {\n          request[key] = angular.copy(value);\n        }\n      });\n\n      //Attach given extra config\n      if (config && angular.isObject(config)) {\n        angular.forEach(config, function (value, key) {\n          request[key] = angular.copy(value);\n        });\n      }\n\n      //Append data if we have a body\n      if (action.hasBody() && data && angular.isObject(data)) {\n        if (angular.isFunction(data.toJSON)) {\n          request.data = data.toJSON();\n        } else if (angular.isArray(data)) {\n          request.data = data;\n        } else {\n          request.data = angular.extend({}, data);\n        }\n      }\n\n      //Ensure we don't overwrite the params objects keys in place\n      params = angular.copy(params);\n\n      //Process params\n      if (params && angular.isObject(params)) {\n        for (var key in params) {\n          if (params.hasOwnProperty(key) && angular.isObject(params[key])) {\n            if (angular.isFunction(params[key].toJSON)) {\n              params[key] = params[key].toJSON();\n            }\n          }\n        }\n      }\n\n      //Combine params out of given params and data and find URL params\n      params = combineParams(action.params, params, data);\n      var urlParams = findUrlParams(request.url);\n\n      //Parse URL\n      request.url = parseUrl(action.url, params, urlParams, action.stripTrailingSlashes);\n\n      //Set remaining given non-url params as query params,\n      //delegate param encoding to $http\n      angular.forEach(params, function (value, key) {\n        if (!urlParams[key]) {\n          request.params = request.params || {};\n          request.params[key] = value;\n        }\n      });\n\n      //Return\n      return request;\n    }\n\n    /**\n     * Api request executer\n     */\n    return function ApiRequest(action, params, data, config) {\n\n      //Parameter juggling\n      if (action.hasBody() && params && !data) {\n        data = params;\n        params = null;\n      }\n\n      //Create request config and use $http to do the request\n      //and intercept the response\n      var request = createRequestConfig(action, params, data, config);\n      return $http(request).then(function (response) {\n        return action.successInterceptor(response);\n      }).catch(function (error) {\n        return action.errorInterceptor(error);\n      });\n    };\n  }]);\n})(window, window.angular);","(function(window, angular, undefined) {'use strict';\n\n/**\n * Module definition and dependencies\n */\nangular.module('Api.Action.Service', [\n  'Url.Service',\n])\n\n/**\n * Factory definition\n */\n.factory('$apiAction', function $apiAction($q, $injector, $log, $url) {\n\n  /**\n   * Return validated model class\n   */\n  function validatedModel(model) {\n\n    //No model?\n    if (!model) {\n      return null;\n    }\n\n    //Validate\n    if (!$injector.has(model)) {\n      if (model !== '$baseModel') {\n        $log.warn('Unknown model class/service:', model);\n      }\n      return null;\n    }\n\n    //Return model\n    return model;\n  }\n\n  /**\n   * Constructor\n   */\n  function ApiAction(action, endpoint) {\n\n    //Set vars\n    angular.extend(this, action);\n\n    //Set full action url, model and method\n    this.url = $url.concat(endpoint.url, this.url || '');\n    this.model = this.model || endpoint.model || false;\n    this.method = this.method || 'GET';\n    this.enforceDataFormat = endpoint.enforceDataFormat || false;\n\n    //Append config\n    if (endpoint.config) {\n      for (let key in endpoint.config) {\n        if (endpoint.config.hasOwnProperty(key)) {\n          this[key] = endpoint.config[key];\n        }\n      }\n    }\n\n    //Determine params\n    if (typeof this.params === 'undefined') {\n      this.params = endpoint.params;\n    }\n\n    //Normalize\n    this.params = this.params || {};\n\n    //Validate model\n    this.model = validatedModel(this.model);\n  }\n\n  /**\n   * Has body check\n   */\n  ApiAction.prototype.hasBody = function() {\n    return /^(POST|PUT|PATCH)$/i.test(this.method);\n  };\n\n  /**\n   * Expects array check\n   */\n  ApiAction.prototype.expectsArray = function() {\n    return Boolean(this.isArray);\n  };\n\n  /**\n   * Expects model check\n   */\n  ApiAction.prototype.expectsModel = function() {\n    return (this.model && Boolean(this.isModel));\n  };\n\n  /**\n   * Convert raw response data to a model\n   */\n  ApiAction.prototype.convertToModel = function(data) {\n\n    //Array given?\n    if (angular.isArray(data)) {\n      return data.map(data => this.convertToModel(data));\n    }\n\n    //No data?\n    if (!data || data === null) {\n      return null;\n    }\n\n    //Get model class and return model instance\n    let Model = $injector.get(this.model);\n    return new Model(data);\n  };\n\n  /**\n   * Default error response interceptor\n   */\n  ApiAction.prototype.parseData = function(data) {\n\n    //Get flags\n    const expectsArray = this.expectsArray();\n    const expectsModel = this.expectsModel();\n\n    //Validate data type\n    const isArray = angular.isArray(data);\n    if (isArray !== expectsArray) {\n\n      //Issue warning\n      $log.warn(\n        'Expected', expectsArray ? 'array' : 'object',\n        'as response, got', isArray ? 'array' : (typeof data),\n        'for', this.method, this.url\n      );\n\n      //Enforce data format?\n      if (this.enforceDataFormat) {\n        data = (expectsArray ? [] : {});\n      }\n    }\n\n    //Empty array if no data sent\n    if (expectsArray && !data) {\n      return [];\n    }\n\n    //Expecting model?\n    if (expectsModel) {\n      return this.convertToModel(data);\n    }\n\n    //Return as is\n    return data;\n  };\n\n  /**\n   * Default success response interceptor\n   */\n  ApiAction.prototype.successInterceptor = function(response) {\n\n    //Get raw response data\n    const raw = response.data;\n    const {dataKey} = this;\n\n    //Using data key?\n    if (dataKey) {\n\n      //Ensure present\n      if (typeof raw[dataKey] === 'undefined') {\n        throw new Error(`Unknown data key: ${dataKey}`);\n      }\n\n      //Parse data and set in raw response\n      raw[dataKey] = this.parseData(raw[dataKey]);\n      return raw;\n    }\n\n    //Simple data, parse and return\n    return this.parseData(raw);\n  };\n\n  /**\n   * Default error response interceptor\n   */\n  ApiAction.prototype.errorInterceptor = function(response) {\n    return $q.reject(response);\n  };\n\n  //Return factory function\n  return function(action, endpoint) {\n    return new ApiAction(action, endpoint);\n  };\n});\n\n})(window, window.angular);\n","(function(window, angular, undefined) {'use strict';\n\n/**\n * Module definition and dependencies\n */\nangular.module('Api.Service', [\n  'Api.Endpoint.Service',\n])\n\n/**\n * Provider definition\n */\n.provider('$api', function $apiProvider() {\n\n  //Defaults\n  this.defaults = {\n    verbose: false,\n    enforceDataFormat: false,\n    baseUrl: '/',\n    actions: {\n      query: {\n        method: 'GET',\n        isArray: true,\n        isModel: true,\n      },\n      get: {\n        method: 'GET',\n        isModel: true,\n      },\n      create: {\n        method: 'POST',\n      },\n      update: {\n        method: 'PUT',\n      },\n      delete: {\n        method: 'DELETE',\n      },\n    },\n    params: {\n      id: '@id',\n    },\n    model: '',\n    config: {},\n    stripTrailingSlashes: true,\n  };\n\n  //Registered endpoints\n  this.endpoints = {};\n\n  /**\n   * Set verbose\n   */\n  this.setVerbose = function(verbose) {\n    this.defaults.verbose = !!verbose;\n    return this;\n  };\n\n  /**\n   * Set base URL\n   */\n  this.setBaseUrl = function(url) {\n    //TODO: the replacement is protecting port numbers from later becoming\n    //removed on account of the request service url parsing thinking it's a\n    //parameter. The code there should be updated to prevent port replacement,\n    //rather than \"protecting\" it in this manner here.\n    this.defaults.baseUrl = url.replace(/:([0-9]+)/, '\\\\:$1');\n    return this;\n  };\n\n  /**\n   * Set data format enforcing\n   */\n  this.setEnforceDataFormat = function(enforce) {\n    this.defaults.enforceDataFormat = !!enforce;\n    return this;\n  };\n\n  /**\n   * Set default actions\n   */\n  this.setDefaultActions = function(actions) {\n    this.defaults.actions = actions || {};\n    return this;\n  };\n\n  /**\n   * Set default params\n   */\n  this.setDefaultParams = function(params) {\n    this.defaults.params = params || {};\n    return this;\n  };\n\n  /**\n   * Set default model\n   */\n  this.setDefaultModel = function(model) {\n    this.defaults.model = model || false;\n    return this;\n  };\n\n  /**\n   * Set a generic config parameter (use only for config params that you\n   * want to pass on to the $http service)\n   */\n  this.setConfig = function(param, value) {\n    this.defaults.config[param] = value;\n    return this;\n  };\n\n  /**\n   * Strip trailing slashes behaviour\n   */\n  this.stripTrailingSlashes = function(strip) {\n    this.defaults.stripTrailingSlashes = !!strip;\n    return this;\n  };\n\n  /**\n   * Register endpoint\n   */\n  this.registerEndpoint = function(name, config) {\n    if (name) {\n      this.endpoints[name] = config || {};\n    }\n    return this;\n  };\n\n  /**\n   * Service getter\n   */\n  this.$get = function($log, $apiEndpoint) {\n\n    //Initialize API interface\n    let Api = function(endpoint) {\n      return this[endpoint];\n    };\n\n    //Append all endpoints\n    angular.forEach(this.endpoints, (config, name) => {\n\n      //Warn if overwriting\n      if (Api[name]) {\n        $log.warn('API endpoint', name, 'is being overwritten.');\n      }\n\n      //Extend endpoint config with defaults\n      config = angular.extend({}, this.defaults, config);\n      if (config.verbose) {\n        $log.info('API endpoint', name + ':', config);\n      }\n\n      //Initialize endpoint\n      Api[name] = $apiEndpoint(name, config);\n    });\n\n    //Return\n    return Api;\n  };\n});\n\n})(window, window.angular);\n","(function(window, angular, undefined) {'use strict';\n\n/**\n * Module definition and dependencies\n */\nangular.module('BaseModel.Service', [])\n\n/**\n * Model definition\n */\n.factory('$baseModel', function($window, $log, $injector) {\n\n  //See if we have the moment service available to us\n  let moment;\n  if ($injector.has('moment')) {\n    moment = $injector.get('moment');\n  }\n  else if (typeof $window.moment !== 'undefined') {\n    moment = $window.moment;\n  }\n\n  /**\n   * Check if given string is a ISO 8601 date string,\n   * Returns a moment if it is and null if it's not\n   */\n  function dateStringToMoment(value) {\n    let regex = /(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}).*/;\n    if (value.match(regex)) {\n      let date = moment(value, moment.ISO_8601, true);\n      if (date.isValid()) {\n        return date;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Copy a property\n   */\n  function copyProperty(obj, key) {\n    if (angular.isArray(obj[key])) {\n      let arr = obj[key];\n      //eslint-disable-next-line no-unused-vars\n      return arr.map((value, key) => copyProperty(arr, key));\n    }\n    if (obj[key] && angular.isFunction(obj[key].clone)) {\n      return obj[key].clone();\n    }\n    return angular.copy(obj[key]);\n  }\n\n  /**\n   * Constructor\n   */\n  function $baseModel(data, parent) {\n\n    //Define parent property\n    let _parent = parent;\n    Object.defineProperty(this, '$parent', {\n      enumerable: false,\n      get() {\n        return _parent;\n      },\n      set(parent) {\n        _parent = parent;\n      },\n    });\n\n    //Load data\n    this.fromJSON(data);\n  }\n\n  /**************************************************************************\n   * Helper methods\n   ***/\n\n  /**\n   * Convert a property to a model\n   */\n  $baseModel.prototype.convertToModel = function(\n    key, Model, isArray\n  ) {\n\n    //Paremeter shuffling\n    if (typeof Model === 'boolean') {\n      isArray = Model;\n      Model = null;\n    }\n\n    //If undefined, check what we were expecting\n    if (typeof this[key] === 'undefined') {\n      if (isArray) {\n        this[key] = [];\n      }\n      else {\n        this[key] = null;\n      }\n    }\n\n    //If no model specified or if empty, we're done\n    if (!Model || !this[key]) {\n      return;\n    }\n\n    //String specified, use injector\n    if (typeof Model === 'string') {\n      if (!$injector.has(Model)) {\n        return $log.warn(\n          'Unknown model', Model, 'specified for sub model conversion'\n        );\n      }\n      Model = $injector.get(Model);\n    }\n\n    //Already a model?\n    if (this[key] instanceof Model) {\n      return;\n    }\n\n    //Get model class and initiate\n    if (angular.isArray(this[key])) {\n      this[key] = this[key].map(data => new Model(data, this));\n    }\n    else if (angular.isString(this[key]) && $baseModel.isId(this[key])) {\n      this[key] = new Model({id: this[key]}, this);\n    }\n    else {\n      this[key] = new Model(this[key], this);\n    }\n  };\n\n  /**\n   * From JSON converter\n   */\n  $baseModel.prototype.fromJSON = function(json) {\n    if (angular.isObject(json)) {\n      angular.forEach(json, (value, key) => {\n        this[key] = $baseModel.valueFromJSON(value);\n      }, this);\n    }\n    return this;\n  };\n\n  /**\n   * To JSON converter\n   */\n  $baseModel.prototype.toJSON = function(data) {\n    let json = {};\n    if (data && angular.isObject(data)) {\n      angular.forEach(data, (value, key) => {\n        json[key] = $baseModel.valueToJSON(value);\n      });\n    }\n    angular.forEach(this, (value, key) => {\n      if (!json.hasOwnProperty(key)) {\n        json[key] = $baseModel.valueToJSON(value);\n      }\n    });\n    return json;\n  };\n\n  /**\n   * Extract a subset of data from the model\n   */\n  $baseModel.prototype.extract = function(properties) {\n\n    //If string given, just return copy of one property\n    if (typeof properties === 'string') {\n      return copyProperty(this, properties);\n    }\n\n    //Initialize object\n    let obj = {};\n\n    //No properties given? Iterate all object properties\n    if (!angular.isArray(properties) || !properties.length) {\n      //eslint-disable-next-line no-unused-vars\n      angular.forEach(this, (value, key) => {\n        if (key.substr(0, 2) !== '$$') {\n          obj[key] = copyProperty(this, key);\n        }\n      });\n    }\n    else {\n      angular.forEach(properties, key => {\n        obj[key] = copyProperty(this, key);\n      });\n    }\n\n    //Return resulting object\n    return obj;\n  };\n\n  /**\n   * Merge a set of data into the model\n   */\n  $baseModel.prototype.merge = function(data) {\n    if (data && angular.isObject(data)) {\n      //eslint-disable-next-line no-unused-vars\n      angular.forEach(data, (value, key) => {\n        this[key] = copyProperty(data, key);\n      });\n    }\n    return this;\n  };\n\n  /**\n   * Clear own properties\n   */\n  $baseModel.prototype.clear = function() {\n    for (let key in this) {\n      if (this.hasOwnProperty(key)) {\n        delete this[key];\n      }\n    }\n    return this;\n  };\n\n  /**\n   * Clone\n   */\n  $baseModel.prototype.clone = function(stripId) {\n    let ModelClass = this.constructor;\n    //TODO: Should this be toJSON() ??\n    let clone = new ModelClass(this.extract(), this.$parent);\n    if (stripId) {\n      delete clone.id;\n    }\n    return clone;\n  };\n\n  /**\n   * Check if two models are the same (based on ID)\n   */\n  $baseModel.prototype.isSame = function(model) {\n    if (!model) {\n      return false;\n    }\n    if (!angular.isObject(model)) {\n      return (this.id === model);\n    }\n    if (!model.id) {\n      return false;\n    }\n    return (this.id && model.id && this.id === model.id);\n  };\n\n  /**\n   * Copy a property\n   */\n  $baseModel.prototype.copyProperty = function(obj, key) {\n    if (this[key] && angular.isFunction(this[key].clone)) {\n      obj[key] = this[key].clone();\n    }\n    else {\n      obj[key] = angular.copy(this[key]);\n    }\n  };\n\n  /**\n   * Set parent\n   */\n  $baseModel.prototype.setParent = function(parent) {\n    this.$parent = parent;\n  };\n\n  /**************************************************************************\n   * Static methods\n   ***/\n\n  /**\n   * Helper to convert a value from JSON\n   */\n  $baseModel.valueFromJSON = function(value) {\n    if (angular.isArray(value)) {\n      return value.map($baseModel.valueFromJSON);\n    }\n    else if (moment && angular.isString(value)) {\n      let date = dateStringToMoment(value);\n      return date || value;\n    }\n    else if (value && angular.isObject(value)) {\n      if (value._isAMomentObject) {\n        return value.clone();\n      }\n      let copy = {};\n      for (let prop in value) {\n        if (value.hasOwnProperty(prop)) {\n          copy[prop] = $baseModel.valueFromJSON(value[prop]);\n        }\n      }\n      return copy;\n    }\n    return value;\n  };\n\n  /**\n  * Helper to convert a value to JSON\n  */\n  $baseModel.valueToJSON = function(value) {\n    if (angular.isArray(value)) {\n      return value.map($baseModel.valueToJSON);\n    }\n    else if (value && angular.isObject(value)) {\n      if (angular.isFunction(value.toJSON)) {\n        return value.toJSON();\n      }\n      let copy = {};\n      for (let prop in value) {\n        if (value.hasOwnProperty(prop) && prop.substr(0, 2) !== '$$') {\n          copy[prop] = $baseModel.valueToJSON(value[prop]);\n        }\n      }\n      return copy;\n    }\n    return value;\n  };\n\n  /**\n   * Strip object to only ID\n   */\n  $baseModel.onlyId = function(obj) {\n    if (angular.isArray(obj)) {\n      return obj.map($baseModel.onlyId);\n    }\n    if (!obj || typeof obj !== 'object' || !obj.id) {\n      return obj;\n    }\n    return obj.id;\n  };\n\n  /**\n   * Strip a given object to specific keys\n   */\n  $baseModel.strip = function(obj, ...keys) {\n    if (angular.isArray(obj)) {\n      return obj.map(obj => $baseModel.strip(obj, ...keys));\n    }\n    if (!obj || typeof obj !== 'object') {\n      return obj;\n    }\n    //eslint-disable-next-line no-unused-vars\n    angular.forEach(obj, (value, key) => {\n      if (!keys.includes(key)) {\n        delete obj[key];\n      }\n    });\n    return obj;\n  };\n\n  /**\n   * Strip ID's recursively from a given object\n   */\n  $baseModel.stripIds = function(obj) {\n    if (angular.isArray(obj)) {\n      return obj.map(obj => $baseModel.stripIds(obj));\n    }\n    if (!obj || typeof obj !== 'object') {\n      return obj;\n    }\n    if (typeof obj.id !== 'undefined') {\n      delete obj.id;\n    }\n    angular.forEach(obj, value => {\n      if (value && typeof value === 'object') {\n        $baseModel.stripIds(value);\n      }\n    });\n    return obj;\n  };\n\n  /**\n   * Test for MongoDB object ID\n   */\n  $baseModel.isId = function(str) {\n    return str.match(/^[a-f\\d]{24}$/i);\n  };\n\n  //Return\n  return $baseModel;\n});\n\n})(window, window.angular);\n","(function(window, angular, undefined) {'use strict';\n\n/**\n * Module definition and dependencies\n */\nangular.module('Api.Endpoint.Service', [\n  'Api.Action.Service',\n  'Api.Request.Service',\n  'Url.Service',\n])\n\n/**\n * Factory definition\n */\n.factory('$apiEndpoint', function $apiEndpoint($url, $apiAction, $apiRequest) {\n\n  /**\n   * Constructor\n   */\n  function ApiEndpoint(name, config) {\n\n    //Determine full URL of endpoint\n    config.actions = config.actions || {};\n    config.url = $url.concat(\n      config.baseUrl, config.url || $url.concat(name, ':id')\n    );\n\n    //Expose config and actions container\n    this.$config = config;\n    this.$actions = {};\n\n    //Create action instances and bind request method to action key on endpoint\n    angular.forEach(config.actions, (action, key) => {\n      this.$actions[key] = $apiAction(action || {}, config);\n      this[key] = angular.bind(this, $apiRequest, this.$actions[key]);\n    });\n  }\n\n  //Return factory function\n  return function(name, config) {\n    return new ApiEndpoint(name, config);\n  };\n});\n\n})(window, window.angular);\n","(function(window, angular, undefined) {'use strict';\n\n/**\n * Module definition and dependencies\n */\nangular.module('Api.Request.Service', [\n  'Url.Service',\n])\n\n/**\n * Factory definition\n */\n.factory('$apiRequest', function $apiRequest($http, $url) {\n\n  /**\n   * Check if dotted path is valid\n   */\n  function isValidDottedPath(path) {\n    return (\n      path && path !== 'hasOwnProperty' &&\n      /^(\\.[a-zA-Z_$@][0-9a-zA-Z_$@]*)+$/.test('.' + path)\n    );\n  }\n\n  /**\n   * Lookup dotted path in an object\n   */\n  function lookupDottedPath(obj, path) {\n\n    //Check if valid\n    if (!isValidDottedPath(path)) {\n      throw new Error('Invalid dotted path:' + path);\n    }\n\n    //Split path in object keys to traverse\n    let keys = path.split('.');\n    for (let i = 0; i < keys.length && obj !== undefined; i++) {\n      let key = keys[i];\n      obj = (obj !== null) ? obj[key] : undefined;\n    }\n\n    //Return reference\n    return obj;\n  }\n\n  /**\n   * Combine given params with extracted params from data\n   */\n  function combineParams(actionParams, givenParams, data) {\n\n    //Extract data params from action params\n    let extractedParams = {};\n    angular.forEach(actionParams || {}, (value, key) => {\n\n      //Function? Call now\n      if (angular.isFunction(value)) {\n        value = value();\n      }\n\n      //String value with @ identifier? Look up in data\n      if (angular.isString(value) && value.charAt(0) === '@') {\n        value = lookupDottedPath(data, value.substr(1));\n      }\n\n      //Set value\n      extractedParams[key] = value;\n    });\n\n    //Extend with given params\n    return angular.extend(extractedParams, givenParams || {});\n  }\n\n  /**\n   * Find URL params\n   */\n  function findUrlParams(url) {\n    let urlParams = {};\n    angular.forEach(url.split(/\\W/), param => {\n\n      //Filter hasOwnProperty\n      if (param === 'hasOwnProperty') {\n        throw new Error('Invalid parameter name: hasOwnProperty');\n      }\n\n      //Find all valid url params (have value, non digit)\n      if (param && !(/^\\\\d+$/.test(param))) {\n        if (new RegExp('(^|[^\\\\\\\\]):' + param + '(\\\\W|$)').test(url)) {\n          urlParams[param] = true;\n        }\n      }\n    });\n    return urlParams;\n  }\n\n  /**\n   * Clean up URL\n   */\n  function cleanUpUrl(url, stripTrailingSlashes) {\n\n    //Strip trailing slashes if needed\n    if (stripTrailingSlashes) {\n      url = url.replace(/\\/+$/, '') || '/';\n    }\n\n    //Replace collapsed `/.` if found in the last URL path segment before\n    //the query, e.g. `http://url.com/id./format?q=x` becomes\n    //`http://url.com/id.format?q=x`\n    return url\n      .replace(/\\/\\.(?=\\w+($|\\?))/, '.')\n      .replace(/\\/\\\\\\./, '/.');\n  }\n\n  /**\n   * Parse URL\n   */\n  function parseUrl(url, params, urlParams, stripTrailingSlashes) {\n\n    //Replace escaped \\:\n    url = url.replace(/\\\\:/g, ':');\n\n    //Loop the valid URL params now\n    //eslint-disable-next-line no-unused-vars\n    angular.forEach(urlParams, (t, urlParam) => {\n\n      //Extract value for this url param from given params\n      let val = params.hasOwnProperty(urlParam) ? params[urlParam] : null;\n      let regex;\n\n      //If defined and not null, encode it and replace in URL\n      if (angular.isDefined(val) && val !== null) {\n        let encodedVal = $url.encodeUriSegment(val);\n        regex = new RegExp(':' + urlParam + '(\\\\W|$)', 'g');\n        //eslint-disable-next-line no-unused-vars\n        url = url.replace(regex, (match, tail) => {\n          return encodedVal + tail;\n        });\n      }\n\n      //Otherwise, remove from URL\n      else {\n        regex = new RegExp('(/?):' + urlParam + '(\\\\W|$)', 'g');\n        //eslint-disable-next-line no-unused-vars\n        url = url.replace(regex, (match, leadingSlashes, tail) => {\n          if (tail.charAt(0) === '/') {\n            return tail;\n          }\n          else {\n            return leadingSlashes + tail;\n          }\n        });\n      }\n    });\n\n    //Return cleaned up URL\n    return cleanUpUrl(url, stripTrailingSlashes);\n  }\n\n  /**\n   * Create request config\n   */\n  function createRequestConfig(action, params, data, config) {\n\n    //Initialize\n    let request = {};\n    let stripConfigKeys = [\n      'params', 'model', 'isArray', 'isModel',\n      'successInterceptor', 'errorInterceptor',\n      'stripTrailingSlashes',\n    ];\n\n    //Map action config to http request config\n    angular.forEach(action, (value, key) => {\n      if (stripConfigKeys.indexOf(key) === -1) {\n        request[key] = angular.copy(value);\n      }\n    });\n\n    //Attach given extra config\n    if (config && angular.isObject(config)) {\n      angular.forEach(config, (value, key) => {\n        request[key] = angular.copy(value);\n      });\n    }\n\n    //Append data if we have a body\n    if (action.hasBody() && data && angular.isObject(data)) {\n      if (angular.isFunction(data.toJSON)) {\n        request.data = data.toJSON();\n      }\n      else if (angular.isArray(data)) {\n        request.data = data;\n      }\n      else {\n        request.data = angular.extend({}, data);\n      }\n    }\n\n    //Ensure we don't overwrite the params objects keys in place\n    params = angular.copy(params);\n\n    //Process params\n    if (params && angular.isObject(params)) {\n      for (let key in params) {\n        if (params.hasOwnProperty(key) && angular.isObject(params[key])) {\n          if (angular.isFunction(params[key].toJSON)) {\n            params[key] = params[key].toJSON();\n          }\n        }\n      }\n    }\n\n    //Combine params out of given params and data and find URL params\n    params = combineParams(action.params, params, data);\n    let urlParams = findUrlParams(request.url);\n\n    //Parse URL\n    request.url = parseUrl(\n      action.url, params, urlParams, action.stripTrailingSlashes);\n\n    //Set remaining given non-url params as query params,\n    //delegate param encoding to $http\n    angular.forEach(params, (value, key) => {\n      if (!urlParams[key]) {\n        request.params = request.params || {};\n        request.params[key] = value;\n      }\n    });\n\n    //Return\n    return request;\n  }\n\n  /**\n   * Api request executer\n   */\n  return function ApiRequest(action, params, data, config) {\n\n    //Parameter juggling\n    if (action.hasBody() && params && !data) {\n      data = params;\n      params = null;\n    }\n\n    //Create request config and use $http to do the request\n    //and intercept the response\n    const request = createRequestConfig(action, params, data, config);\n    return $http(request)\n      .then(response => action.successInterceptor(response))\n      .catch(error => action.errorInterceptor(error));\n  };\n});\n\n})(window, window.angular);\n"],"sourceRoot":"/source/"}